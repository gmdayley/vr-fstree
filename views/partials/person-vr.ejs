<%
  var missing = false;
  if(typeof person === 'undefined'){
    person = {
      display: {}
    };
    missing = true;
  }

var level = 1;
  for(let gen=1; gen <= 8; gen++)  {
    console.log('gen', gen, Math.pow(2, gen-1), position)
    if (position >= Math.pow(2, gen-1)) {
      level = gen;
    } else {
      break;
    }
  }
  var index = position - Math.pow(2, level-1);
  var offset = -(Math.pow(2, level-1) * 6 / 2) + index*6;
  console.log('position location:', position, level, index, offset)
  console.log('gender', person.display.gender, person.display.sex)
  var portraitUrl = person.display.portrait;
  if (!portraitUrl) {
    const gender = (person.display.gender || 'unknown').toLocaleLowerCase();
    portraitUrl = `/images/${gender}-placeholder.jpg`;
  }
%>

<a-box position="<%= offset %> <%= level*3 %> -20" width="5" depth="0.2" height="2" material="transparent: true; opacity: 0.2" look-at="a-camera">
  <a-circle position="-1.4 0 0" <%- portraitUrl %>
            material="shader: flat; side: double"></a-circle>
  <a-text colorx="black" position="-0.4 0.3 0" value="<%= person.display.name %>"></a-text>
  <a-text colorx="black" position="-0.4 0 0" value="<%= person.display.lifespan %>"></a-text>
  <a-text colorx="black" position="-0.4 -0.3 0" value="<%= person.id %>"></a-text>

</a-box>